---
title: jyyos代码导读和课程记录（17-28）
date: 2023-10-06 23:04:30
tags:
- 操作系统
- jyyos
---

# lecture17
进程的这个状态机可以用（M，R）来表示，R很简单，但是M是什么呢？
有两个基本的问题
1. 下面程序的输出是什么？
```c
printf("%p\n", main);
```
2. 何种指针访问不会触发segment fault？
```c
char *p = random();
*p; // 什么时候访问合法？ 
```

进程地址空间管理
三个API：mmap,munmap,mprotect

使用mmap：两个例子，一个见下mmap-alloc，一个是：
```python
with open('/dev/sda', 'rb') as fp:
    mm = mmap.mmap(fp.fileno(),prot=mmap.PROT_READ, length=128 << 30)
    hexdump.hexdump(mm[:512])
```

入侵地址空间：一个展示

## minimal
{% asset_img img01.png %}
{% asset_img img02.png %}
{% asset_img img03.png %}

## mmap-alloc
瞬间分配

# lecture18

## dsu

{% asset_img img04.png %}

> 里面有一个彩蛋，padding的代码时做测试用的，为的是能够触发func的代码在页边界的情况

好的代码：
1. 不言自明
2. 不言自证
3. 帮助理解状态机

有一些比较经典的资料等等细节

## calc
一个绝对不可读的代码，一个计算器的小程序

## *thread-os
用好工具，现在我们来调试这个代码（这个代码不懂，就不要想lab2了）
AskGPT: Can I print process memory maps inside gdb?
AskGPT: Can I visualize a process-internal data structure in gdb?
{% asset_img img06.png %}

上面两条给了我们指明了前进的道路
{% asset_img img05.png %}

AskGPT: How to use Python to parse and check/visualize C/C++ program state in GDB?

然后就写了`visualize.py`.这里注册了一个`rdump`的命令，就可以使用来格式化一些数据！！
{% asset_img img07.png %}

我们也注册了一个`pdump`的命令！
{% asset_img img08.png %}

行号的实现也是ask GPT
{% asset_img img09.png %}




更进一步我们可以做任何事情tui window api & gdbgui

再有想象力一点：
{% asset_img img10.png %}

最后我们一个总结
{% asset_img img11.png %}

# lecture19

UNIX shell
os（kernel） = API + 对象

{% asset_img img12.png %}

shell 是一门把用户指令翻译成系统调用的**编程语言**

1. 基于文本替换的快速工作流搭建
{% asset_img img13.png %}
2. job control(类似于window窗口的X，[], --)
